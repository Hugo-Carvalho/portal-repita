<!DOCTYPE html>
<html lang="pt" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/LayoutPadrao}">

<head>
	<title>Notas não aprovadas</title>
</head>

<body>
	<section layout:fragment="conteudo">
		<div class="page-header">
			<div class="container-fluid">
				<h1>Notas não aprovadas - Não atribuídas</h1>
			</div>
		</div>
		<div class="container-fluid">

			<input hidden type="text" id="msgErro" th:value="${msgErro}" />
			<div style="display: none;" class="pop-outer">
				<div class="pop-inner">
					<button class="close">X</button>
					<h1><span th:inline="text">[[${msgErro}]]</span></h1>
				</div>
			</div>

            <div class="pull-right">
				<label>Recarregar: </label>
				<select id="reloader" class="form-group" onchange="reloader(this.value);">
					<option value="desl." text="desl.">desl.</option>
					<option value="10000" text="10 seg">10 seg</option>
					<option value="20000" text="20 seg">20 seg</option>
					<option value="40000" text="40 seg">40 seg</option>
					<option value="60000" text="1 min">1 min</option>
					<option value="180000" text="3 min">3 min</option>
				</select>
			</div>
			<table class="table table-hover">
				<thead class="thead-dark">
					<tr>
						<th class="text-center">#</th>
						<th class="text-center">Numero do chamado</th>
						<th class="text-center">Contrato</th>
						<th class="text-center">Atribuir</th>
						<th class="text-center">Editar</th>
					</tr>
				</thead>
				<tbody class="text-center">
					<tr th:each="allNotaNaoAprovAndNaoAtrib : ${allNotaNaoAprovAndNaoAtrib}">
						<td><span th:text="${allNotaNaoAprovAndNaoAtrib.id}"></span></td>
						<td><span th:text="${allNotaNaoAprovAndNaoAtrib.numChamado}"></span></td>
						<td><span th:text="${allNotaNaoAprovAndNaoAtrib.contrato}"></span></td>
						<td>
							<div th:switch="${tipoUsuario}"> 
								<div th:case="admin">
									<select  onchange="atribuir(this.value, this.options[this.selectedIndex].text);">
										<option value="Selecione..." text="Selecione...">Selecione...</option>
										<option id="atribuir" th:each="usuario : ${usuarios}" th:value="${allNotaNaoAprovAndNaoAtrib.id}" th:text="${usuario.user}"></option>
									</select>
								</div>
								<div th:case="*">
									<a class="waves-effect waves-light btn-small" th:href="${(#mvc.url('NNAC#atribuirNota').arg(0, allNotaNaoAprovAndNaoAtrib.id)).build()}"><i class="material-icons left"><span class="glyphicon glyphicon-check text-success"></span></i></a>
								</div>
							</div>
						</td>
						<td><a class="waves-effect waves-light btn-small" th:href="@{/editarNota(id = ${allNotaNaoAprovAndNaoAtrib.id}, pageAnt = @{notasNaoAprovadasNaoAtribuidas})}"><i class="material-icons left"><span class="glyphicon glyphicon-edit text-warning"></span></i></a></td>
					</tr>
				</tbody>
			</table>
		</div>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
		<script>

			var time = localStorage.getItem('time');
			if(time != null){
        		document.getElementById("reloader").value = time;
			} else {
				document.getElementById("reloader").value = 'desl.';
			}

			function reloader(time){
				localStorage.setItem('time', time);
				location.reload();
			}

			time = document.getElementById("reloader").value;

			if(time != "desl."){
				setTimeout(function(){ 
					localStorage.setItem('time', time);
					location.reload();
				}, time);
			}

			var erro = document.getElementById('msgErro');

			if(erro.value != ""){
				$(".pop-outer").fadeIn("slow");
			}

			$(document).ready(function (){
				$(".close").click(function (){
					$(".pop-outer").fadeOut("slow");
					window.location.href = "/notasNaoAprovadasNaoAtribuidas";
				});
				$(".pop-outer").click(function (){
					$(".pop-outer").fadeOut("slow");
					window.location.href = "/notasNaoAprovadasNaoAtribuidas";
				});
			});

			function atribuir(id, user){
				if(user != "Selecione..."){
					window.location.href = "/atribuirNotaTo?id=" + id + "&user=" + user;
				}
			}
		</script>
	</section>
</body>
</html>